<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parallelization - Foundation Model for Climate Notes</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="notes_for_talks.html"><strong aria-hidden="true">2.</strong> Notes for Talks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="a_data_perspective.html"><strong aria-hidden="true">2.1.</strong> A Data-Oriented Perspective</a></li><li class="chapter-item expanded "><a href="ai4good.html"><strong aria-hidden="true">2.2.</strong> Ai for Good talk</a></li></ol></li><li class="chapter-item expanded "><a href="tropical_cyclones.html"><strong aria-hidden="true">3.</strong> Tropical Cyclones</a></li><li class="chapter-item expanded "><a href="foundation_models.html"><strong aria-hidden="true">4.</strong> Foundation Models</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="gnns.html"><strong aria-hidden="true">4.1.</strong> GNNs</a></li><li class="chapter-item expanded "><a href="vits.html"><strong aria-hidden="true">4.2.</strong> ViTs</a></li><li class="chapter-item expanded "><a href="general_circulation_models.html"><strong aria-hidden="true">4.3.</strong> General Circulation Models</a></li><li class="chapter-item expanded "><a href="liquid_neural_networks.html"><strong aria-hidden="true">4.4.</strong> Liquid Neural Networks</a></li><li class="chapter-item expanded "><a href="linear_transformers.html"><strong aria-hidden="true">4.5.</strong> Linear Transformers</a></li><li class="chapter-item expanded "><a href="linear_transformers_as_fwp.html"><strong aria-hidden="true">4.6.</strong> Linear Transformers as FWP</a></li></ol></li><li class="chapter-item expanded "><a href="papers.html"><strong aria-hidden="true">5.</strong> Papers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="climax.html"><strong aria-hidden="true">5.1.</strong> ClimaX</a></li><li class="chapter-item expanded "><a href="panguweather.html"><strong aria-hidden="true">5.2.</strong> PanguWeather</a></li><li class="chapter-item expanded "><a href="fuxi.html"><strong aria-hidden="true">5.3.</strong> FuXi</a></li><li class="chapter-item expanded "><a href="graphcast.html"><strong aria-hidden="true">5.4.</strong> GraphCast</a></li><li class="chapter-item expanded "><a href="fourcastnet.html"><strong aria-hidden="true">5.5.</strong> FourcastNet</a></li><li class="chapter-item expanded "><a href="spatio-temporal_swin-transformer.html"><strong aria-hidden="true">5.6.</strong> Spatio-Temporal Swin-Transformer</a></li><li class="chapter-item expanded "><a href="ace.html"><strong aria-hidden="true">5.7.</strong> ACE</a></li><li class="chapter-item expanded "><a href="closed-form_continuous-time_neural_networks.html"><strong aria-hidden="true">5.8.</strong> Closed-form continuous-time neural networks</a></li><li class="chapter-item expanded "><a href="metnet.html"><strong aria-hidden="true">5.9.</strong> MetNet</a></li><li class="chapter-item expanded "><a href="recurrent_fast_weight_programmers.html"><strong aria-hidden="true">5.10.</strong> Recurrent Fast Weight Programmers</a></li></ol></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">6.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="parallelization.html" class="active"><strong aria-hidden="true">6.1.</strong> Parallelization</a></li></ol></li><li class="chapter-item expanded "><a href="model_comparison.html"><strong aria-hidden="true">7.</strong> Model Comparison</a></li><li class="chapter-item expanded "><a href="challenges_and_opportunities.html"><strong aria-hidden="true">8.</strong> Challenges and Opportunities</a></li><li class="chapter-item expanded "><a href="improvements.html"><strong aria-hidden="true">9.</strong> FM4C Improvements</a></li><li class="chapter-item expanded "><a href="reference.html"><strong aria-hidden="true">10.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Foundation Model for Climate Notes</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/lelepado01/FoundationModel4ClimateNotes/tree/main/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/lelepado01/FoundationModel4ClimateNotes/edit/main/src/parallelization.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="parallelization"><a class="header" href="#parallelization">Parallelization</a></h1>
<h2 id="techniques-for-pytorch"><a class="header" href="#techniques-for-pytorch">Techniques for pytorch</a></h2>
<ul>
<li>DDP: the model is copied on all processes, the dataset is split on all the workers and each model is fed a different batch gradient communication is used to keep the models in sync (also overlap of gradient computation)</li>
<li>RPC: used if training paradigm can’t fit using DDP</li>
<li>Collective Comms: foundation for RPC and DDP, low level APIs</li>
</ul>
<h2 id="paradigms"><a class="header" href="#paradigms">Paradigms</a></h2>
<ul>
<li>Model Parallelism: each worker focuses on a portion of the model, best for large models.</li>
<li>Data Parallelism: split train set on each worker, shared weights (DDP)</li>
<li>Parameter server architecture: central node with parameters, workers update the weights by computing the gradient </li>
<li>All-Reduce Comms: several workers compute private gradient, then combine with all-reduce operation to share global gradient.</li>
<li>Gradient accumulation: compute gradient on several minibatches, used if comms overhead is high.</li>
</ul>
<h2 id="distributed-deep-learning"><a class="header" href="#distributed-deep-learning">Distributed deep learning</a></h2>
<p>Distributed training is the process of subdividing the training workload of, for example, a large neural
network across multiple processors. These processors are often referred to as workers, and they are
tasked to compute in parallel to speed up the training process. There are two approaches to parallelism:
data and model. In data parallelism, the full training set is divided between all the workers, where a
copy of the model is also kept. Training is done either synchronously, where all the workers wait for
each other, synchronize the gradients, and only then perform the backward step; or asynchronously,
where a selected worker is tasked with keeping an updated version of the weights, and all the others
can read and write from this worker, often called a ”parameter server”. Using the latter procedure
means that all resources are used at the same time, without any delay. However, it also means that
only one worker at a time is training with the latest version of the weights. In large clusters the
centralized nature of this approach can also create bottlenecks. Model parallelism, on the other hand,
divides the model either horizontally, i.e. node-wise, or vertically, i.e. layer-wise, between several
workers who are allowed to run at the same time. This approach also reduces the footprint of the
model in each worker, making it lighter on the GPU’s memory.</p>
<h3 id="ddp"><a class="header" href="#ddp">DDP</a></h3>
<p>Distributed Data Parallel is a method of data parallelism that enables a program to operate on
numerous machines simultaneously. Applications utilizing DDP generate numerous processes and
initialize one DDP instance for each process. </p>
<h3 id="fsdp"><a class="header" href="#fsdp">FSDP</a></h3>
<p>In some cases, it may not be possible to create a duplicate of the model for every process. In
these instances, Fully Sharded Data Parallel may be utilized, where the optimiser states, gradients,
and parameters of the model are subdivided across all DDP ranks. In this case, the neural network is
divided into smaller sub-models, each of which represents a portion of the parameters of the overall
model. This approach allows different parts of the model to be processed simultaneously by different
processing units, and can be used in conjunction with a data-parallel approach that splits the training
set to achieve even faster processing times. This results in a program that has less impact on GPU
memory, thus reducing execution times.</p>
<h3 id="deepspeed"><a class="header" href="#deepspeed">DeepSpeed</a></h3>
<p>DeepSpeed is a deep learning optimisation suite that enables efficient scalability and faster
execution times for both training and inference of large machine learning models. It was developed
by Microsoft and claims to offer a 15x speedup over other state-of-the-art parallelization techniques.
It provides memory efficient data parallelism and enables training without model parallelism through
a novel solution called Zero Redundancy Optimizer. Unlike basic data parallelism, where memory
states are replicated across data-parallel processes, ZeRO partitions model states and gradients to save
significant memory. Several other memory optimisation techniques are also used, such as Constant
Buffer Optimisation, which combines all communication-based operations into a single operand, and
Contiguous Memory Optimisation, which reduces fragmentation during training.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="development.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="model_comparison.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="development.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="model_comparison.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
